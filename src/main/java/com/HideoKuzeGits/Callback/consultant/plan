
//////////////////////////////// Виджет консультанта ////////////////////////////////////

                        Менеджер отключилься
- Чат
- Менеджер отключилься
- Если есть еще менеджеры то предлагаем перекинуть диалог им если нету то предлагаем отправить письмо
- Отказ виджет на время сессии (до закрытия браузера исчезает)
- Сворачивание
- Розварачивание переходим к пункту 3


                                 ВХОД
- Информация о том что все менеджеры офлайн
- Сообщения менеджера
- Информация о том что менеджер отключилься.
- Информация о соеденении с менеджером
- Пинг

                                 ВЫХОД
- Сообщение клиента (сообщение + ид чата + ид пользователя)
- Информация о том что клиент отключился.
- Понг
- Данные клиента (имя, имейл, телефон, домен)
- Запрос о переносе чата


////////////////////////////// Клиент для менеджеров. //////////////////////////////////////////

                                ВХОД

- Сообщения клиент (сообщение + ид чата + ид пользователя)
- Сообщение о том что клиент отключился
- Возможность получить историю
- Возможность получить данные о клиенте (имя, имейл, телефон), и чате (домен)
- Пинг
- Перенос чата (фрагмент чата + ид чата + ид пользователя )

                                ВЫХОД

- Сообщения менеджера (сообщение + ид чата + ид пользователя)
- Сообщение о том что менеджер отключился.
- Понг


////////////////////////////// Бекенд //////////////////////////////////////////////////////////

- Переправлять сообщения клиента менеджеру
- Переправлять сообщения менеджера клиенту
- Сохранять историю основываясь на бесконечной куке пользователя.
- Сохранять соответствие клиента и его информации
- Сохранять соответствие ид чата с сессионной кукой.
- Сохранять соответствие ид пользователя и ид чата
- Отслеживать с помощью пинг понга менеджера и отправлять клиенту сообщение если тот отключилься
- По запросу передавать информацию о том есть ли менеджеры онлайн
- С помощью пинг понга отслеживать клиента и если тот отключиться передавать сообщение менеджеру
- Обрабатывать запрос о переносе чата находя текущий чат по ид. И пересылая информацию другому менеджеру  (фрагмент чата + ид чата + ид пользователя)
- Система выбора менеджера с наименьшей загрузкой из тех что онлайн.

                                 Сообщения

- Приходит сообщение от клиента
- Проверяем в карте есть ли информация о чате под этим ид

                                 Если нет

- Запрашиваем домен (реквест респонс)
- Запрашиваем информацию о пользователе (асинхронно)
- Опрашиваем всех менеджеров на предмет онлайна
- Посмотреть по карте менеджер количество обрабатываемых чатов наименее загруженного менеджера ответ null приравниваем 0
- Перенаправляем ему сообщение з чата и инфу о чате
- Наращиваем в карте количество обрабатываемых менеджером чатов

                                 Если есть

- Отправляем менеджеру сообщение
- Сохраняем историю чата

                                 Если произошла ошибка отправки или соединение разорвано

- Находим менеджера или клиента которому принадлежало соединение и отправляем сообщение о разрыве

- Отправка уведомления на мыло пользователю

                                Пересылка чата

- Запрос у клиента истории.
- Поиск наименее за груженого, свободного менеджера
- Отправка ему чата (Объект история)


////////////////////////////// POJO //////////////////////////////////////////////////////////


               Информация о чате
- Ид чата
- Информация о пользователе

               Информация о пользователе (Информация об адресате супер класс)

- Ид пользователя
- Домен
- Имя пользователя
- email
- Телефон

                История

- Информация о пользователе (ид)
- Список сообщений (упорядоченный)


                Сообщение

- Ид сообщения
- Время сообщения
- Адресат сообщения или менеджер или пользователь
- Текст сообщения

            Менеджер
- Ид            
- Email
- Имя
- Фамилия
- Хозяин 






